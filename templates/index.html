<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
        background-color: #f8f9fa;
      }

	  #page-container {
		  display: flex;
		  justify-content: center;
		  padding-top: 5vh;
		  padding-left: 1rem;
		  padding-right: 1rem;
		  max-width: 100%;
		}

      #tool-card {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        max-width: 600px;
        width: 100%;
      }

      #control-ids {
        resize: vertical;
        min-height: 160px;
      }

      #control-help {
        padding-left: 0;
        font-size: 0.9rem;
        color: #0d6efd;
        border: none;
        background: none;
        text-align: left;
      }

      #control-help:hover {
        text-decoration: underline;
      }

	  #control-invalid {
		display: none;
		color: red;
	  }

      #control-submit {
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      }
    </style>
  </head>

  <body>
    <div id="page-container">
      <div id="tool-card">
        <h1 class="h3 fw-bold text-center mb-3">CF Minecraft Mod Compat</h1>
        <p class="text-center text-muted mb-4">
          Find the game version that best matches compatibility with a list of mods.
        </p>

        <div class="mb-3">
          <label for="control-ids" class="form-label">Mod IDs</label>
          <button id="control-help">Where do I find mod IDs?</button>
          <textarea id="control-ids" class="form-control mt-2" placeholder="Paste mod IDs here (one per line)"></textarea>
		  <p id="control-invalid">One or more IDs are invalid</p>
        </div>

        <div class="d-grid">
          <button id="control-submit" class="btn btn-primary">Submit</button>
        </div>
      </div>
    </div>
  </body>

	<script>
		const controlHelp = document.getElementById("control-help");
		const controlIds = document.getElementById("control-ids");
		const controlInvalid = document.getElementById("control-invalid");
		const controlSubmit = document.getElementById("control-submit");

		controlSubmit.addEventListener("click", async (e) => {
			const normalized = controlIds.value.replace(/\r\n/g, "\n");
			const dataIdsList = normalized
				.split("\n")
				.map(id => id.trim())           // Remove surrounding whitespace
				.filter(id => id.length > 0);   // Remove empty lines

			if (dataIdsList.length == 0) {
				return;
			}

			// Check if any ID is invalid (contains non-digit characters)
			const hasInvalid = dataIdsList.some(id => /[^0-9]/.test(id));

			if (hasInvalid) {
				console.error("One or more IDs are invalid (contain non-digit characters).");
				controlIds.style.borderColor = "red";
				controlInvalid.style.display = "block";
				return;
			}

			// Reset error signs
			controlIds.style.borderColor = "initial";
			controlInvalid.style.display = "none";

			const uniqueIds = [...new Set(dataIdsList)];
			const jsonIds = JSON.stringify(uniqueIds);

			const response = await fetch("/api", {
				method: "POST",
				body: jsonIds,
				headers: {
					"Content-Type": "application/json"
				}
			});

			if (!response.ok) {
				console.log("API returned !ok");
				return;
			}
			console.log("OK");
		});
	</script>
</html>

